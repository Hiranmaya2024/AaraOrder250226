<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AAradhya Order App</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>

body{font-family:Inter;margin:0;background:#f1f3f6}

.topbar{
background:#0b5ed7;
padding:10px;
color:#fff;
}

.search{
width:100%;
padding:10px;
border:none;
border-radius:8px;
}

.party{
background:#fff;
padding:8px 12px;
font-size:13px;
font-weight:600;
}

.grid{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:10px;
padding:10px;
}

.card{
background:#fff;
border-radius:12px;
padding:12px;
box-shadow:0 2px 6px rgba(0,0,0,.08);
}

.title{font-size:13px;font-weight:600;height:34px;overflow:hidden}

.price{font-size:16px;font-weight:700;color:#198754}
.mrp{text-decoration:line-through;font-size:12px;color:#777}

.badge{
background:#e7f1ff;
color:#0b5ed7;
font-size:11px;
padding:3px 6px;
border-radius:6px;
display:inline-block;
margin-top:4px;
}

.qty{
display:flex;
justify-content:space-between;
align-items:center;
margin-top:8px;
}

.qty button{
background:#0b5ed7;
border:none;
color:#fff;
width:28px;height:28px;
border-radius:6px;
font-size:18px;
}

.cartbar{
position:fixed;
bottom:0;
width:100%;
background:#fff;
padding:10px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 -2px 6px rgba(0,0,0,.1);
}

.cartbtn{
background:#ff9f00;
color:#fff;
padding:10px 16px;
border:none;
border-radius:8px;
font-weight:600;
}

.hidden{display:none}

</style>
</head>

<body>

<div class="topbar">
<input class="search" placeholder="Search company or product" onkeyup="searchData(this.value)">
</div>

<div class="party">
Party: <input id="party" placeholder="Enter shop name">
</div>

<div id="screen" class="grid"></div>

<div class="cartbar">
<div><b id="cartItems">0 items</b><br>₹<span id="cartTotal">0</span></div>
<button class="cartbtn" onclick="openCart()">View Cart</button>
</div>

<script>

const url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRV-mdlstMlh93FOZn0udO4eCUyryl_pDziljwksKkWGVdxE2LH8excr6D-cABN61O-JrFigpecb42i/pub?gid=0&single=true&output=csv";

let data=[],cart={},mode="company",currentCompany="";

fetch(url).then(r=>r.text()).then(csv=>{
let rows=csv.split("\n").slice(1);

data=rows.map(r=>{
let c=r.split(",");
return{company:c[0],name:c[1],pack:c[2],rate:+c[3],mrp:c[4],scheme:c[7]}
});

showCompanies();
});

function showCompanies(){
mode="company";

let companies=[...new Set(data.map(d=>d.company))];

screen.innerHTML=companies.map(c=>`
<div class="card" onclick="openCompany('${c}')">
<div class="title">${c}</div>
</div>`).join("");
}

function openCompany(c){
mode="product";
currentCompany=c;

let items=data.filter(d=>d.company===c);

screen.innerHTML=items.map(i=>productCard(i)).join("");
}

function productCard(i){

let qty=cart[i.name]?.qty||0;

return`
<div class="card">
<div class="title">${i.name}</div>
<div class="price">₹${i.rate} <span class="mrp">₹${i.mrp}</span></div>
<div class="badge">${i.scheme||""}</div>

<div class="qty">
<button onclick="changeQty('${i.name}',${i.rate},-1)">−</button>
<div>${qty}</div>
<button onclick="changeQty('${i.name}',${i.rate},1)">+</button>
</div>

</div>`;
}

function changeQty(name,rate,delta){

let qty=(cart[name]?.qty||0)+delta;

if(qty<=0){delete cart[name]}
else{cart[name]={qty,rate}}

updateCartUI();
openCompany(currentCompany);
}

function updateCartUI(){

let total=0,count=0;

for(let i in cart){
total+=cart[i].qty*cart[i].rate;
count+=cart[i].qty;
}

cartItems.innerText=count+" items";
cartTotal.innerText=total.toFixed(2);
}

function openCart(){

let html="";

for(let i in cart){

let amt=cart[i].qty*cart[i].rate;

html+=`
<div class="card">
${i}<br>
${cart[i].qty} x ₹${cart[i].rate}
<div style="float:right">₹${amt.toFixed(2)}</div>
</div>`;
}

screen.innerHTML=html;
}

function searchData(val){

val=val.toLowerCase();

if(mode=="company"){
showCompanies();
}

}

</script>

</body>
</html>
