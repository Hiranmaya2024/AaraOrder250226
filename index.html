<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AAradhya Order App</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{font-family:Inter;margin:0;background:#f1f3f6}

.topbar{background:#0b5ed7;padding:10px}
.search{width:100%;padding:10px;border:none;border-radius:8px}

.party{background:#fff;padding:8px 12px;font-size:13px;font-weight:600}

.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;padding:10px}

.card{background:#fff;border-radius:12px;padding:12px;box-shadow:0 2px 6px rgba(0,0,0,.08)}

.title{font-size:13px;font-weight:600}
.price{font-size:16px;font-weight:700;color:#198754}
.mrp{text-decoration:line-through;font-size:12px;color:#777}

.badge{background:#e7f1ff;color:#0b5ed7;font-size:11px;padding:3px 6px;border-radius:6px;margin-top:4px;display:inline-block}

.qty{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
.qty button{background:#0b5ed7;border:none;color:#fff;width:28px;height:28px;border-radius:6px;font-size:18px}

.cartbar{
position:fixed;bottom:0;width:100%;
background:#fff;padding:10px;
display:flex;justify-content:space-between;align-items:center;
box-shadow:0 -2px 6px rgba(0,0,0,.1)
}

.cartbtn{background:#ff9f00;color:#fff;padding:10px 16px;border:none;border-radius:8px;font-weight:600}

.loading{padding:20px;text-align:center;font-weight:600}
</style>
</head>

<body>

<div class="topbar">
<input class="search" placeholder="Search">
</div>

<div class="party">
Party: <input id="party" placeholder="Enter shop name">
</div>

<div id="screen" class="grid">
<div class="loading">Loading catalogue...</div>
</div>

<div class="cartbar">
<div><b id="cartItems">0 items</b><br>₹<span id="cartTotal">0</span></div>
<button class="cartbtn" onclick="openCart()">View Cart</button>
</div>

<script>

const url="https://api.allorigins.win/raw?url=https://docs.google.com/spreadsheets/d/e/2PACX-1vRV-mdlstMlh93FOZn0udO4eCUyryl_pDziljwksKkWGVdxE2LH8excr6D-cABN61O-JrFigpecb42i/pub?gid=0&single=true&output=csv";
let data=[],cart={},mode="company",currentCompany="";

function parseCSV(text){
const rows = text.trim().split("\n").slice(1);
return rows.map(r=>{
const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
return {
company:c[0]?.replace(/"/g,""),
name:c[1]?.replace(/"/g,""),
pack:c[2]?.replace(/"/g,""),
rate:parseFloat(c[3])||0,
mrp:c[4]?.replace(/"/g,""),
scheme:c[7]?.replace(/"/g,"")
}
});
}

fetch(url)
.then(r=>r.text())
.then(text=>{
data=parseCSV(text);
showCompanies();
})
.catch(()=>{
screen.innerHTML="<div class='loading'>❌ Failed to load data</div>";
});

function showCompanies(){

mode="company";

const companies=[...new Set(data.map(d=>d.company).filter(Boolean))];

screen.innerHTML=companies.map(c=>`
<div class="card" onclick="openCompany('${c}')">
<div class="title">${c}</div>
</div>`).join("");
}

function openCompany(c){

mode="product";
currentCompany=c;

const items=data.filter(d=>d.company===c);

screen.innerHTML=items.map(i=>productCard(i)).join("");
}

function productCard(i){

const qty=cart[i.name]?.qty||0;

return `
<div class="card">
<div class="title">${i.name}</div>
<div class="price">₹${i.rate} <span class="mrp">₹${i.mrp}</span></div>
${i.scheme?`<div class="badge">${i.scheme}</div>`:""}

<div class="qty">
<button onclick="changeQty('${i.name}',${i.rate},-1)">−</button>
<div>${qty}</div>
<button onclick="changeQty('${i.name}',${i.rate},1)">+</button>
</div>
</div>`;
}

function changeQty(name,rate,delta){

let qty=(cart[name]?.qty||0)+delta;

if(qty<=0) delete cart[name];
else cart[name]={qty,rate};

updateCartUI();
openCompany(currentCompany);
}

function updateCartUI(){

let total=0,count=0;

for(let i in cart){
total+=cart[i].qty*cart[i].rate;
count+=cart[i].qty;
}

cartItems.innerText=count+" items";
cartTotal.innerText=total.toFixed(2);
}

function openCart(){

let html="";

for(let i in cart){
let amt=cart[i].qty*cart[i].rate;

html+=`
<div class="card">
${i}<br>
${cart[i].qty} x ₹${cart[i].rate}
<div style="float:right">₹${amt.toFixed(2)}</div>
</div>`;
}

screen.innerHTML=html || "<div class='loading'>Cart is empty</div>";
}

</script>

</body>
</html>
