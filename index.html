<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AAradhya Order Book</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>

body{font-family:Poppins;margin:0;background:#f4f6f9}

.header{
background:#0b5ed7;color:#fff;padding:14px;
font-size:18px;font-weight:600;
display:flex;align-items:center
}

.container{padding:10px}

.grid2{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:10px;
}

@media(min-width:700px){
.grid2{grid-template-columns:repeat(3,1fr);}
}

.card{
background:#fff;
padding:12px;
border-radius:12px;
box-shadow:0 2px 6px rgba(0,0,0,.08)
}

.company{
font-weight:600;
font-size:14px;
text-align:center;
}

.item-title{
font-weight:600;
font-size:13px;
min-height:36px;
}

.meta{
font-size:12px;
margin-top:4px;
}

.qtybox{
display:flex;
gap:6px;
margin-top:6px;
}

.qtybox input{
flex:1;
padding:6px;
border-radius:6px;
border:1px solid #ddd;
}

button{
background:#0b5ed7;color:#fff;border:none;
padding:8px;border-radius:6px;width:100%;
font-size:12px;margin-top:4px
}

.fab{
position:fixed;bottom:20px;right:20px;
background:#198754;color:#fff;
padding:14px 18px;border-radius:50px;
font-weight:600;box-shadow:0 4px 10px rgba(0,0,0,.2)
}

.hidden{display:none}

.totalBox{
background:#fff;
position:sticky;
bottom:0;
padding:12px;
font-weight:600;
font-size:18px
}

</style>
</head>

<body>

<div class="header" id="header">üè¢ Companies</div>

<div class="container">

<input type="text" id="party" placeholder="Enter Party Name">

<div id="companyScreen" class="grid2"></div>
<div id="itemScreen" class="grid2 hidden"></div>
<div id="cartScreen" class="hidden"></div>

</div>

<div class="fab" onclick="openCart()">üõí Cart (<span id="cartCount">0</span>)</div>

<script>

const url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRV-mdlstMlh93FOZn0udO4eCUyryl_pDziljwksKkWGVdxE2LH8excr6D-cABN61O-JrFigpecb42i/pub?gid=0&single=true&output=csv";

let data=[],cart=[],currentCompany="";

fetch(url).then(r=>r.text()).then(csv=>{
let rows=csv.split("\n").slice(1);

data=rows.map(r=>{
let c=r.split(",");
return{
company:c[0],name:c[1],pack:c[2],
rate:parseFloat(c[3]),mrp:c[4],scheme:c[7]
}
});

loadCompanies();
});

function loadCompanies(){
header.innerHTML="üè¢ Companies";
companyScreen.classList.remove("hidden");
itemScreen.classList.add("hidden");
cartScreen.classList.add("hidden");

let companies=[...new Set(data.map(d=>d.company))];

companyScreen.innerHTML=companies.map(c=>`
<div class="card company" onclick="openItems('${c}')">${c}</div>
`).join("");
}

function openItems(comp){
currentCompany=comp;
header.innerHTML=`‚¨Ö ${comp}`;
companyScreen.classList.add("hidden");
itemScreen.classList.remove("hidden");

let items=data.filter(d=>d.company===comp);

itemScreen.innerHTML=items.map(i=>`
<div class="card">
<div class="item-title">${i.name}</div>
<div class="meta">${i.pack}</div>
<div class="meta">MRP: ${i.mrp}</div>
<div class="meta">PTR: ‚Çπ${i.rate}</div>
<div class="meta">Sch: ${i.scheme||"-"}</div>

<div class="qtybox">
<input type="number" id="q_${i.name}" placeholder="Qty">
</div>

<button onclick="addCart('${i.name}','${i.pack}',${i.rate})">Add</button>
</div>
`).join("");

header.onclick=loadCompanies;
}

function addCart(name,pack,rate){
let qty=document.getElementById("q_"+name).value;
if(!qty) return;

cart.push({name,pack,rate,qty});
cartCount.innerText=cart.length;
}

function openCart(){

header.innerHTML="‚¨Ö Cart";
cartScreen.classList.remove("hidden");
companyScreen.classList.add("hidden");
itemScreen.classList.add("hidden");

let total=0;

cartScreen.innerHTML=cart.map(c=>{
let amt=c.qty*c.rate;
total+=amt;

return`
<div class="card">
${c.name}<br>
${c.qty} x ‚Çπ${c.rate}
<div style="float:right;font-weight:600">‚Çπ${amt.toFixed(2)}</div>
</div>`;
}).join("")+

`<div class="totalBox">Total ‚Çπ${total.toFixed(2)}
<button onclick="placeOrder(${total})">Confirm Order</button>
</div>`;

header.onclick=()=>openItems(currentCompany);
}

function placeOrder(total){

let party=document.getElementById("party").value;

let msg="*AARADHYA PHARMACEUTICALS*%0A";
msg+="Party : "+party+"%0A%0A";

cart.forEach((c,i)=>{
let amt=c.qty*c.rate;
msg+=`${i+1}. ${c.name} (${c.pack})%0AQty : ${c.qty} Rate : ${c.rate} Amount : ${amt}%0A`;
});

msg+=`%0ATotal : ‚Çπ${total}`;

window.open("https://wa.me/?text="+msg);
}

</script>

</body>
</html>
