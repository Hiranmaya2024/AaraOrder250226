<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AAradhya Order Book</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body{font-family:Poppins;margin:0;background:#f4f6f9}
.header{background:#0b5ed7;color:#fff;padding:14px;font-size:18px;font-weight:600}
.container{padding:10px}
.grid2{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
@media(min-width:700px){.grid2{grid-template-columns:repeat(3,1fr)}}

.card{background:#fff;padding:12px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.08)}
.item-title{font-weight:600;font-size:13px;min-height:34px}
.meta{font-size:12px}

.qty-control{display:flex;align-items:center;margin-top:6px}
.qty-control button{
width:32px;height:32px;border:none;background:#0b5ed7;color:#fff;font-size:18px;border-radius:6px
}
.qty-control input{
width:45px;text-align:center;margin:0 6px;border:1px solid #ddd;border-radius:6px;height:32px
}

.fab{
position:fixed;bottom:20px;right:20px;
background:#198754;color:#fff;padding:14px 18px;border-radius:50px;font-weight:600
}
.hidden{display:none}
</style>
</head>

<body>

<div class="header" id="header">üè¢ Companies</div>

<div class="container">
<input type="text" id="party" placeholder="Enter Party Name">
<div id="companyScreen" class="grid2"></div>
<div id="itemScreen" class="grid2 hidden"></div>
</div>

<div class="fab" onclick="openCart()">üõí Cart (<span id="cartCount">0</span>)</div>

<script>

const url="https://docs.google.com/spreadsheets/d/e/2PACX-1vRV-mdlstMlh93FOZn0udO4eCUyryl_pDziljwksKkWGVdxE2LH8excr6D-cABN61O-JrFigpecb42i/pub?gid=0&single=true&output=csv";

let data=[],cart={},currentCompany="";

fetch(url).then(r=>r.text()).then(csv=>{
let rows=csv.split("\n").slice(1);

data=rows.map(r=>{
let c=r.split(",");
return{company:c[0],name:c[1],pack:c[2],rate:parseFloat(c[3]),mrp:c[4],scheme:c[7]}
});

loadCompanies();
});

function loadCompanies(){
header.innerHTML="üè¢ Companies";
companyScreen.classList.remove("hidden");
itemScreen.classList.add("hidden");

let companies=[...new Set(data.map(d=>d.company))];

companyScreen.innerHTML=companies.map(c=>`
<div class="card" onclick="openItems('${c}')"><b>${c}</b></div>
`).join("");
}

function openItems(comp){

currentCompany=comp;
header.innerHTML=`‚¨Ö ${comp}`;
header.onclick=loadCompanies;

companyScreen.classList.add("hidden");
itemScreen.classList.remove("hidden");

let items=data.filter(d=>d.company===comp);

itemScreen.innerHTML=items.map((i,index)=>`

<div class="card">

<div class="item-title">${i.name}</div>
<div class="meta">${i.pack}</div>
<div class="meta">MRP: ${i.mrp}</div>
<div class="meta">PTR: ‚Çπ${i.rate}</div>
<div class="meta">Sch: ${i.scheme||"-"}</div>

<div class="qty-control">
<button onclick="updateQty('${i.name}',${i.rate},${index},-1)">‚àí</button>
<input type="number" id="qty_${index}" value="0"
onchange="manualQty('${i.name}',${i.rate},${index})">
<button onclick="updateQty('${i.name}',${i.rate},${index},1)">+</button>
</div>

</div>

`).join("");
}

function updateQty(name,rate,index,delta){

let input=document.getElementById("qty_"+index);
let qty=parseInt(input.value)||0;

qty+=delta;
if(qty<0)qty=0;

input.value=qty;
syncCart(name,rate,qty);
}

function manualQty(name,rate,index){
let qty=document.getElementById("qty_"+index).value;
syncCart(name,rate,qty);
}

function syncCart(name,rate,qty){

if(qty<=0){
delete cart[name];
}else{
cart[name]={qty:parseInt(qty),rate:rate};
}

cartCount.innerText=Object.keys(cart).length;
}

function openCart(){

let total=0;
let html="";

for(let item in cart){
let amt=cart[item].qty*cart[item].rate;
total+=amt;

html+=`<div class="card">${item}<br>
${cart[item].qty} x ‚Çπ${cart[item].rate}
<div style="float:right;font-weight:600">‚Çπ${amt.toFixed(2)}</div>
</div>`;
}

html+=`<div class="card"><b>Total ‚Çπ${total.toFixed(2)}</b></div>`;

itemScreen.innerHTML=html;
header.innerHTML="‚¨Ö Cart";
header.onclick=()=>openItems(currentCompany);
}

</script>

</body>
</html>
